<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTTP Waterfall Demo</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 40px 20px;
      background: #fafafa;
    }

    h1 {
      color: #1f2937;
      margin-bottom: 8px;
    }

    .subtitle {
      color: #6b7280;
      margin-bottom: 40px;
    }

    .demo-section {
      margin-bottom: 40px;
    }

    .demo-section h2 {
      color: #374151;
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 2px solid #e5e7eb;
    }

    .demo-section p {
      color: #6b7280;
      margin-bottom: 20px;
    }

    http-waterfall {
      margin-bottom: 30px;
    }

    .nav {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .nav a {
      color: #2563eb;
      text-decoration: none;
      margin-right: 16px;
    }

    .nav a:hover {
      text-decoration: underline;
    }

    .theme-toggle {
      background: #2563eb;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
      margin-left: auto;
    }

    .theme-toggle:hover {
      background: #1d4ed8;
    }
  </style>
</head>
<body>
  <div class="nav">
    <a href="index.html">‚Üê back to demos</a>
    <a href="http-console-demo.html">http-console demo</a>
    <a href="live-capture.html">‚Üí live capture demo</a>
    <button class="theme-toggle" onclick="toggleTheme()">üåô Dark Mode</button>
  </div>

  <h1>HTTP Request Viewer</h1>
  <p class="subtitle">Visualize multiple HTTP requests in three different views</p>

  <div class="demo-section">
    <h2>Example: API Call Sequence</h2>
    <p>Multiple API calls made during a page load. Try switching between the three views:</p>
    <ul>
      <li><strong>List</strong> - Detailed view with expandable request/response data</li>
      <li><strong>Duration</strong> - Shows request durations relative to each other (best for independent requests)</li>
      <li><strong>Waterfall</strong> - Shows timing relationships when requests happen close together (best for page loads)</li>
    </ul>
    <http-waterfall id="example1" view="waterfall"></http-waterfall>
  </div>

  <!-- http-console.js is imported by http-waterfall.js -->
  <script type="module" src="../src/http-waterfall.js?v=5"></script>
  <script type="module">
    await customElements.whenDefined('http-waterfall');

    // Example 1: API call sequence
    document.getElementById('example1').exchanges = [
      {
        request: {
          method: 'GET',
          url: '/api/user/profile',
          httpVersion: 'HTTP/1.1',
          headers: {
            'Accept': 'application/json',
            'Authorization': 'Bearer token123'
          },
          body: null
        },
        response: {
          status: 200,
          statusText: 'OK',
          httpVersion: 'HTTP/1.1',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ id: 1, name: 'John Doe' }, null, 2)
        },
        timing: {
          startTime: 0,
          endTime: 87,
          duration: 87
        }
      },
      {
        request: {
          method: 'GET',
          url: '/api/user/posts',
          httpVersion: 'HTTP/1.1',
          headers: {
            'Accept': 'application/json',
            'Authorization': 'Bearer token123'
          },
          body: null
        },
        response: {
          status: 200,
          statusText: 'OK',
          httpVersion: 'HTTP/1.1',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify([
            { id: 1, title: 'First Post' },
            { id: 2, title: 'Second Post' }
          ], null, 2)
        },
        timing: {
          startTime: 20,
          endTime: 176,
          duration: 156
        }
      },
      {
        request: {
          method: 'POST',
          url: '/api/analytics/track',
          httpVersion: 'HTTP/1.1',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer token123'
          },
          body: JSON.stringify({ event: 'page_view' })
        },
        response: {
          status: 201,
          statusText: 'Created',
          httpVersion: 'HTTP/1.1',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ success: true })
        },
        timing: {
          startTime: 95,
          endTime: 137,
          duration: 42
        }
      },
      {
        request: {
          method: 'GET',
          url: '/api/notifications',
          httpVersion: 'HTTP/1.1',
          headers: {
            'Accept': 'application/json',
            'Authorization': 'Bearer token123'
          },
          body: null
        },
        response: {
          status: 200,
          statusText: 'OK',
          httpVersion: 'HTTP/1.1',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ notifications: [] }, null, 2)
        },
        timing: {
          startTime: 110,
          endTime: 198,
          duration: 88
        }
      },
      {
        request: {
          method: 'GET',
          url: '/api/user/settings',
          httpVersion: 'HTTP/1.1',
          headers: {
            'Accept': 'application/json',
            'Authorization': 'Bearer token123'
          },
          body: null
        },
        response: {
          status: 404,
          statusText: 'Not Found',
          httpVersion: 'HTTP/1.1',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ error: 'Settings not found' })
        },
        timing: {
          startTime: 180,
          endTime: 242,
          duration: 62
        }
      }
    ];

    // Theme toggle functionality
    // Initialize based on system preference
    let isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

    // Set initial button text and body background
    window.addEventListener('load', () => {
      const button = document.querySelector('.theme-toggle');
      button.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
      document.body.style.background = isDark ? '#1f2937' : '#fafafa';
    });

    window.toggleTheme = function() {
      isDark = !isDark;
      const theme = isDark ? 'dark' : 'light';
      const button = document.querySelector('.theme-toggle');

      // Update all http-waterfall elements
      document.querySelectorAll('http-waterfall').forEach(el => {
        el.setAttribute('theme', theme);
      });

      // Update button text
      button.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';

      // Update body background and text colors
      document.body.style.background = isDark ? '#1f2937' : '#fafafa';
      document.body.style.color = isDark ? '#f3f4f6' : '#1f2937';

      // Update headings
      document.querySelectorAll('h1, h2, h3').forEach(el => {
        el.style.color = isDark ? '#f3f4f6' : '#1f2937';
      });

      // Update subtitle
      document.querySelectorAll('.subtitle').forEach(el => {
        el.style.color = isDark ? '#9ca3af' : '#6b7280';
      });

      // Update demo sections
      document.querySelectorAll('.demo-section p').forEach(el => {
        el.style.color = isDark ? '#9ca3af' : '#6b7280';
      });

      document.querySelectorAll('.demo-section h2').forEach(el => {
        el.style.borderColor = isDark ? '#4b5563' : '#e5e7eb';
      });

      // Update list items
      document.querySelectorAll('li').forEach(el => {
        el.style.color = isDark ? '#9ca3af' : '#374151';
      });
    };
  </script>
</body>
</html>
